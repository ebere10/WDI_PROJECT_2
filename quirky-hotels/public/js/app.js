"use strict";var App=App||{},google=google;App.init=function(){this.apiUrl="http://localhost:3000/api",this.$main=$("main"),$(".hotels").on("click",this.hotels.bind(this)),this.getToken()?this.loggedInState():this.loggedOutState()},App.loggedInState=function(){$(".loggedIn").show(),$(".loggedOut").hide()},App.loggedOutState=function(){$(".loggedIn").hide(),$(".loggedOut").show(),this.hotels()},App.register=function(o){o&&o.preventDefault(),$(".modal-content").html('\n    <form method="post" action="/register">\n    <div class="modal-header">\n      <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n        <span aria-hidden="true">&times;</span>\n      </button>\n      <h4 class="modal-title">Login</h4>\n    </div>\n    <div class="modal-body">\n      <div class="form-group">\n        <input class="form-control" type="text" name="user[username]" placeholder="Username">\n      </div>\n      </div>\n      <div class="modal-body">\n        <div class="form-group">\n          <input class="form-control" type="email" name="user[email]" placeholder="Email">\n        </div>\n        </div>\n      <div class="modal-body">\n      <div class="form-group">\n  <input class="form-control" type="password" name="user[password]" placeholder="Password">\n      </div>\n      </div>\n      <div class="modal-body">\n        <div class="form-group">\n                <input class="form-control" type="password" name="user[passwordConfirmation]" placeholder="Password Confirmation">\n        </div>\n        </div>\n      <div class="modal-footer">\n      <input class="btn btn-primary" type="submit" value="Register">\n      </div>\n    </form>\n  '),$(".modal-content").modal("show")},App.register2=function(o){o&&o.preventDefault(),this.$main.html('\n    <h2>Register</h2>\n    <form method="post" action="/register">\n      <div class="form-group">\n        <input class="form-control" type="text" name="user[username]" placeholder="Username">\n      </div>\n      <div class="form-group">\n        <input class="form-control" type="email" name="user[email]" placeholder="Email">\n      </div>\n      <div class="form-group">\n        <input class="form-control" type="password" name="user[password]" placeholder="Password">\n      </div>\n      <div class="form-group">\n        <input class="form-control" type="password" name="user[passwordConfirmation]" placeholder="Password Confirmation">\n      </div>\n      <input class="btn btn-primary" type="submit" value="Register">\n    </form>\n  ')},App.hotels=function(o){console.log("all hotels"),o&&o.preventDefault(),this.$main.html('\n    <h2>All Hotels</h2>\n    <div id="map-canvas"></div>\n  '),this.mapSetup()},App.login=function(o){o&&o.preventDefault(),$(".modal-content").html('\n    <form method="post" action="/login">\n    <div class="modal-header">\n      <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n        <span aria-hidden="true">&times;</span>\n      </button>\n      <h4 class="modal-title">Login</h4>\n    </div>\n    <div class="modal-body">\n      <div class="form-group">\n        <input class="form-control" type="email" name="email" placeholder="Email">\n      </div>\n      </div>\n      <div class="modal-body">\n      <div class="form-group">\n        <input class="form-control" type="password" name="password" placeholder="Password">\n      </div>\n      </div>\n      <div class="modal-footer">\n      <input class="btn btn-primary" type="submit" value="Login">\n      </div>\n    </form>\n  '),$(".modal-content").modal("show")},App.logout=function(o){o.preventDefault(),this.removeToken(),this.loggedOutState()},App.handleForm=function(o){console.log("handleForm"),o.preventDefault();var n=""+App.apiUrl+$(this).attr("action"),e=$(this).attr("method"),t=$(this).serialize();return App.ajaxRequest(n,e,t,function(o){o.token&&App.setToken(o.token),App.loggedInState()})},App.ajaxRequest=function(o,n,e,t){return $.ajax({url:o,method:n,data:e,beforeSend:this.setRequestHeader.bind(this)}).done(t).fail(function(o){console.log(o)})},App.setRequestHeader=function(o){return o.setRequestHeader("Authorization","Bearer "+this.getToken())},App.setToken=function(o){return window.localStorage.setItem("token",o)},App.getToken=function(){return window.localStorage.getItem("token")},App.removeToken=function(){return window.localStorage.clear()},App.mapSetup=function(){var o=document.getElementById("map-canvas"),n={zoom:12,center:new google.maps.LatLng(51.506178,(-.088369)),mapTypeId:google.maps.MapTypeId.ROADMAP};this.map=new google.maps.Map(o,n),this.getHotels()},App.loopThroughHotels=function(o){console.log(o),$.each(o,function(o,n){console.log("loopThroughHotels"),setTimeout(function(){App.createMarkerForHotel(n)},50*o)})},App.getHotels=function(){$.get(this.apiUrl+"/hotels").done(this.loopThroughHotels)},App.createMarkerForHotel=function(o){console.log("marker creation");var n=new google.maps.LatLng(o.lat,o.lng),e=new google.maps.Marker({position:n,map:this.map,animation:google.maps.Animation.DROP});this.addInfoWindowForHotel(o,e)},App.addInfoWindowForHotel=function(o,n){var e=this;google.maps.event.addListener(n,"click",function(){"undefined"!=typeof e.infoWindow&&e.infoWindow.close(),e.infoWindow=new google.maps.InfoWindow({content:'<img src="'+o.image+'"><p>'+o.name+"</p>"}),e.infoWindow.open(e.map,n),e.map.setCenter(n.getPosition()),e.map.setZoom(15)})},$(App.init.bind(App));