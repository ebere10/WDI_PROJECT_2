"use strict";var App=App||{},google=google;App.init=function(){this.apiUrl="http://localhost:3000/api",this.$main=$("main"),$(".landing").on("click",this.landing.bind(this)),$(".register").on("click",this.register.bind(this)),$(".login").on("click",this.login.bind(this)),$(".logout").on("click",this.logout.bind(this)),$(".hotels").on("click",this.hotels.bind(this)),this.$main.on("submit","form",this.handleForm),this.getToken()?this.loggedInState():this.loggedOutState()},App.loggedInState=function(){$(".loggedIn").show(),$(".loggedOut").hide(),this.hotels()},App.loggedOutState=function(){$(".loggedIn").hide(),$(".loggedOut").show(),this.landing()},App.register=function(e){e&&e.preventDefault(),this.$main.html('\n    <h2>Register</h2>\n    <form method="post" action="/register">\n      <div class="form-group">\n        <input class="form-control" type="text" name="user[username]" placeholder="Username">\n      </div>\n      <div class="form-group">\n        <input class="form-control" type="email" name="user[email]" placeholder="Email">\n      </div>\n      <div class="form-group">\n        <input class="form-control" type="password" name="user[password]" placeholder="Password">\n      </div>\n      <div class="form-group">\n        <input class="form-control" type="password" name="user[passwordConfirmation]" placeholder="Password Confirmation">\n      </div>\n      <input class="btn btn-primary" type="submit" value="Register">\n    </form>\n  ')},App.landing=function(e){console.log("landing"),e&&e.preventDefault(),this.$main.html("\n    <h5>?</h5>\n  "),this.mapSetup()},App.hotels=function(e){console.log("all hotels"),e&&e.preventDefault(),this.$main.html('\n    <div id="map-canvas"></div>\n  '),this.mapSetup()},App.login=function(e){e.preventDefault(),$(".modal-content").html('\n    <form method="post" action="/login">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        <h4 class="modal-title">Login</h4>\n      </div>\n      <div class="modal-body">\n\n        <div class="form-group">\n          <input class="form-control" type="email" name="email" placeholder="Email">\n        </div>\n        <div class="form-group">\n          <input class="form-control" type="password" name="password" placeholder="Password">\n        </div>\n\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>\n        <button type="submit" class="btn btn-primary">Login</button>\n      </div>\n    </form>'),$(".modal").modal("show")},App.logout=function(e){e.preventDefault(),this.removeToken(),this.loggedOutState()},App.handleForm=function(e){console.log("handleForm"),e.preventDefault();var t=""+App.apiUrl+$(this).attr("action"),o=$(this).attr("method"),i=$(this).serialize();return App.ajaxRequest(t,o,i,function(e){e.token&&App.setToken(e.token),App.loggedInState()})},App.ajaxRequest=function(e,t,o,i){return $.ajax({url:e,method:t,data:o,beforeSend:this.setRequestHeader.bind(this)}).done(i).fail(function(e){console.log(e)})},App.setRequestHeader=function(e){return e.setRequestHeader("Authorization","Bearer "+this.getToken())},App.setToken=function(e){return window.localStorage.setItem("token",e)},App.getToken=function(){return window.localStorage.getItem("token")},App.removeToken=function(){return window.localStorage.clear()},App.mapSetup=function(){var e=document.getElementById("map-canvas"),t={zoom:2,center:new google.maps.LatLng(35.823803,.289411),mapTypeId:google.maps.MapTypeId.ROADMAP,styles:[{featureType:"all",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"all",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"all",elementType:"labels.text.fill",stylers:[{saturation:36},{color:"#000000"},{lightness:40}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#ffffff"},{lightness:16}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{lightness:20},{hue:"#00b3ff"}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#e31b1b"},{lightness:17},{weight:1.2},{visibility:"off"}]},{featureType:"administrative",elementType:"labels.text",stylers:[{visibility:"on"}]},{featureType:"administrative.country",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"administrative.province",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"administrative.neighborhood",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"administrative.land_parcel",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"geometry",stylers:[{weight:"0"},{visibility:"on"},{color:"#ebebf0"}]},{featureType:"landscape",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"landscape.man_made",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"landscape.natural",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"landscape.natural.landcover",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"landscape.natural.terrain",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#ebebf0"}]},{featureType:"poi",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi.attraction",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi.business",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#ebebf0"}]},{featureType:"poi.park",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#f9ff53"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#ecf500"},{lightness:29},{weight:.2},{visibility:"off"}]},{featureType:"road.highway",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#ebebf0"},{lightness:18},{visibility:"off"}]},{featureType:"road.arterial",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#ebebf0"},{visibility:"off"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#ebebf0"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#85929e"},{lightness:"98"}]}]};this.map=new google.maps.Map(e,t),this.getHotels()},App.loopThroughHotels=function(e){console.log(e),$.each(e,function(e,t){console.log("loopThroughHotels"),setTimeout(function(){App.createMarkerForHotel(t)},50*e)})},App.getHotels=function(){$.get(this.apiUrl+"/hotels").done(this.loopThroughHotels)},App.createMarkerForHotel=function(e){console.log("marker creation");var t=new google.maps.LatLng(e.lat,e.lng),o=new google.maps.Marker({position:t,map:this.map,icon:"http://wfarm1.dataknet.com/static/resources/icons/set101/cc0f6458.png",animation:google.maps.Animation.DROP});this.addInfoWindowForHotel(e,o)},App.addInfoWindowForHotel=function(e,t){var o=this;google.maps.event.addListener(t,"click",function(){console.log("open?"),"undefined"!=typeof o.infoWindow&&o.infoWindow.close(),o.infoWindow=new google.maps.InfoWindow({content:"<h4>"+e.name+'</h4><img src="'+e.image+'"><p>'+e.country+"</p><p>"+e.description+"</p>"}),o.infoWindow.open(o.map,t),o.map.setCenter(t.getPosition()),o.map.setZoom(8),google.maps.event.addListenerOnce(App.map,"bounds_changed",function(){this.getZoom()&&this.setZoom(16)}),console.log(o.infoWindow),google.maps.event.addListener(App.infoWindow,"closeclick",function(){App.map.setCenter(t.getPosition()),App.map.setZoom(2)})})},$(App.init.bind(App));